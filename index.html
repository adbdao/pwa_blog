<!DOCTYPE HTML>
<html>
<meta charset="utf-8">

<head>
    <title>三德精舍APP</title>
    <base target="_blank">

    <!-- <link rel="stylesheet" href="css1.css" /> -->
    <link rel="icon" href="icons/sd48.png" />

    <link rel="canonical" href="https://adbdao.github.io/pwa_blog/" />
    <link rel="manifest" href="/pwa_blog/blog.webmanifest">
    <!-- <script src="nf.js"></script> -->
    <style>
/* *{border-radius: 8px;padding: 3px;} */
/*html{background: black;color:gray;}*/
/* 反白選取 */
::selection{background: darkred;color:yellow;}
::-moz-selection{background: darkred;color:yellow;}

body {background: -webkit-linear-gradient(right, peru 0.00%, gold 90.00%);background: linear-gradient(right, peru 0.00%, gold 90.00%);}

table{height: 100%;width: 100%;border: 0;text-align: center;}

/* 全部按鈕 */
button {border-radius: 15px;border:0; background: -webkit-linear-gradient(top, #ffe 0%, #ddd 15%, #bbb 85%, #777 100%); background: linear-gradient(top, #ffe 0%, #ddd 15%, #bbb 85%, #777 100%);box-shadow: 4px 3px 4px silver,8px 7px 7px gray;}
button:active,textarea:active{border-color: indigo #f3f #f6f indigo;border-width:5px;border-style:solid;box-shadow: -5px -5px 20px darkorchid;}
/* 上邊全部按鈕 */
.tdup{height: 10vh;width: 50vw;}
/* 各別按鈕 */
#addPWA{height: 90%;color: blue; font-size: 12pt; text-align: justify;}
#reload{height:90%;color: green; font-size: 18pt;  text-align: justify;}
/* 下邊全部按鈕 */
.tddown{height: 20vh;width: 20vw;}
.btnshow{height: 90%;width: 90%; color: brown; font-size: 20pt; }


/* .btnmula{height: 20vh;width: 100%;}
.divmula{height: 80vh;width: 100%;} */

#blog1 {height: 60vh;width: 100%;overflow: auto;background-image: url(icons/sd512.png);background-size: 100% 100%;}
#div5 {height: 70vh;width: 100%;background:#ff8;}
#blog2 {height: 100%;width: 100%;overflow: auto;background-image: url(icons/sd512.png);background-size: 100% 100%;}
/* 全部頁面 */
.divShow{display: none;}
/* 各別頁面 */
/* #div0 {background:#ccc;background:#fec;} */
#div1 {display: block;}

#div2 {background:#ebe;height: 70vh;width: 100%;text-align: center;}
#nfShow,#gkShow{height: 50%;width: 100%;padding: 2vh 0 0 0 ; font-size: 24pt;color: blue;overflow: auto;}
.nfNumClass{font-size: 24pt;color: green;width: 50vw;}
.nf{font-size: 24pt;color: indigo;}

#div3 {background:#aea;height: 70vh;width: 100%;text-align: center;}
.gkNumClass{font-size: 24pt;color: rgb(194, 172, 194);width: 50vw;}
#gkNum2{width: 30vw;}
.gk{color: green;}

/* #div4 {background:#f99} */
#div4 {background:tan;height: 70vh;width: 100%;}
.clean{color: black;display: none;position: absolute;width: 250px;height: 200px;}
.clean td{padding: 5px 5px;}
#cleanShow{height: 90%;width: 100%;overflow: auto;
    /* background-image: url(icons/sd512.png);background-size: 100% 100%;opacity: 0.5; */
}
/* 日期、人名樣式 */
span{color: darkgreen;}
font{color: crimson;}
/* 關於我 */
#me,#me td{border:1px solid black;font-size: 16pt;color:black;text-align: left;border-spacing:0 0 ;}
#txt1{width: 1px;height: 1px;border: 0;}

/* 豎屏狀態的css */
@media screen and (orientation:portrait){
/* *{border-radius: 8px;padding: 3px;} */
/*html{background: black;color:gray;}*/
/* 反白選取 */
/* ::selection{background: darkred;color:yellow;}
::-moz-selection{background: darkred;color:yellow;} */

/* body {background: -webkit-linear-gradient(right, peru 0.00%, gold 90.00%);background: linear-gradient(right, peru 0.00%, gold 90.00%);} */

/* table{height: 100%;width: 100%;border: 0;text-align: center;} */

/* 全部按鈕 */
button {border-radius: 25px;box-shadow: 8px 7px 8px silver,16px 14px 14px gray;}
/* button:active,textarea:active{border-color: indigo #f3f #f6f indigo;border-width:5px;border-style:solid;box-shadow: -5px -5px 20px darkorchid;} */
/* 上邊全部按鈕 */
#first{height: 8vh;}
.tdup{height: 7vh;}
/* 各別按鈕 */
#addPWA{ font-size: 24pt;}
#reload{ font-size: 36pt;}
/* 下邊全部按鈕 */
.tddown{height: 10vh;}
.btnshow{ font-size: 40pt; }


/* .btnmula{height: 20vh;width: 100%;}
.divmula{height: 80vh;width: 100%;} */

/* 新聞頁加長 */
#div1 {height: 70vh;}
/* #blog1 {background: red;} */
/* #blog2 {height: 75vh;} */

/* 全部頁面 */
.divShow{height: 80vh;}
/* 各別頁面 */
/* #div0 {background:#ccc;background:#fec;} */
/* #div1 {display: block;} */

/* #div2 {background:#ebe;height: 70vh;width: 100%;text-align: center;} */
#nfShow{height: 75%;font-size: 32pt;}
#gkShow{height: 70%;font-size: 32pt;}
.nfNumClass{font-size: 48pt;}
.nf{font-size: 48pt;}

/* #div3 {background:#aea;height: 70vh;width: 100%;text-align: center;} */
/* #div3 {background:#ff8;} */
.gkNumClass{font-size: 48pt;}
/* #gkNum2{width: 30vw;}
.gk{color: green;} */

/* #div4 {background:#f99} */
/* #div4 {background:tan;height: 70vh;width: 100%;text-align: center;} */
.clean{width: 600px;height: 500px;}
#cleanShow{ font-size: 48pt;}
#me,#me td{font-size: 32pt;}
}
</style>
<script>
window.onload = function () {
    // 循環顯示div
    function showdiv(divID) {
        var divNone = document.getElementsByClassName('divShow')
        for (var i = 0; i < divNone.length; i++) {
            divNone[i].style.display = 'none'
        }
        divID.style.display = 'block'
    }
    // 循環顯示div，套用在按鈕上
    btn1.onclick = () => { showdiv(div1) }
    btn2.onclick = () => { showdiv(div2) }
    btn3.onclick = () => { showdiv(div3) }
    btn4.onclick = () => { showdiv(div4) }
    btn5.onclick = () => { showdiv(div5) }
    // 顯示「刪除所有記錄」按鈕，套用在按鈕上
    btnClean0.onclick = () => {
        var buttonNone = document.getElementsByClassName('clean')
        // for (var i = 0; i < buttonNone.length; i++) {
        // if (buttonNone[i].style.display == 'none') {
        //     buttonNone[i].style.display = 'block'
        // } else {
        //     buttonNone[i].style.display = 'none'
        // }
        // }
        // 後來整合成一個表格，所以一次就夠了
        if (buttonNone[0].style.display == 'none') {
            buttonNone[0].style.display = 'block'
        } else {
            buttonNone[0].style.display = 'none'
        }
    }

    // 通用函數
    // 今日日期、時間
    function addDate() {
        var oDate = new Date()
        var dtr = oDate.getFullYear() + '-' + (oDate.getMonth() + 1) + '-' + oDate.getDate()
        var htr = oDate.getHours() + ':' + oDate.getMinutes() + ':' + oDate.getSeconds()
        return dtr + '~' + htr
    }
    // 查詢「瀏覽器本地存儲」中的內容，編號到幾號，返回下一個新編號
    function localNum(name) {
        for (var j = 1; j < 99999; j++) {
            if (!localStorage[name + j]) {
                // 不能用break，會中斷函數
                // break
                return j
            }
        }
    }
    // 查詢「瀏覽器本地存儲」中的內容，編號到幾號，返回編號總數
    function localNumTime(name) {
        var DataSumTime = Number(localNum(name)) - 1
        return '總共輸入' + DataSumTime + '次，'
    }
    // 查詢「瀏覽器本地存儲」中的內容，全部導入陣列，並返回陣列
    var DataAll = []
    function localDataAll(name) {
        for (var j = 1; j < 99999; j++) {
            if (localStorage[name + j]) {
                // 加上樣式，區分日期、人名
                DataAll.push(localStorage[name + j].replace(/([^~]+)(~[^ ]+ )(.+)/, '<span>$1</span>$2<font>$3</font>' + logo))
            } else {
                // 這裡可以加break，會快很多
                break
            }
        }
    }
    // 查詢「瀏覽器本地存儲」中的內容，統計總數，並返回數字
    function localDataSum(name, ones) {
        var DataSum = 0, DataTime = 0
        for (var j = 1; j < 99999; j++) {
            if (localStorage[name + j]) {
                // 加上樣式，區分日期、人名
                DataSum += Number(localStorage[name + j].replace(/[^ ]+ \D+(\d+)\D+/, '$1'))
            } else {
                // 總計筆數
                DataTime = j - 1
                // 這裡可以加break，會快很多
                break
            }
        }
        return '總共輸入' + DataTime + '次，總計' + DataSum + ones + logo
    }
    function Copy() {
        // 結束時選取並複製文本框中的內容
        txt1.select()
        document.execCommand('Copy')
        alert('已複製你查詢的內容，可以直接到別的APP中「貼上」')
    }
    var logo = '<span>/三德精舍(埤頭)</span>'

    // 輸入的佛號數字，導入「瀏覽器本地存儲」，並加上日期，並且顯示在div
    // 記錄頁面有無東西
    var s1, s2
    nfShow.innerHTML = ''
    btnSave1.onclick = () => {
        var nf1 = nfNum1.value
        if (!nf1) {
            alert('請輸入數目')
        } else {
            if (confirm('確定儲存？')) {
                localStorage['nf' + localNum('nf')] = addDate() + ' 念佛' + nf1 + '聲'
                // 頁面有查詢內容，就歸零
                if (s1 == 1) {
                    nfShow.innerHTML = ''
                    s1 = 0
                }
                nfShow.innerHTML += addDate() + ' <font>念佛' + nf1 + '聲</font>' + logo + '<br>'
                // 清空輸入的資料，才不會重複儲存
                nfNum1.value = null
            }
        }
    }
    // 查詢「瀏覽器本地存儲」中的內容，全部導入陣列，並返回
    btnSearch1.onclick = () => {
        // 查詢內容
        localDataAll('nf')
        // 顯示
        nfShow.innerHTML = DataAll.join('<br>')
        // alert(DataAll.join('\n'))
        // 清除使用過的陣列
        DataAll.length = 0
        // 記錄頁面已有資料
        s1 = 1
    }
    // 查詢「瀏覽器本地存儲」中的內容，統計總數，並返回數字
    btnSum1.onclick = () => {
        // 查詢內容+顯示
        nfShow.innerHTML = localDataSum('nf', '句佛號')
        // 記錄頁面已有資料
        s1 = 1
    }
    // 複製頁面顯示的任何資料
    btnCopy1.onclick = () => {
        txt1.value = nfShow.innerText
        Copy()
    }

    // 輸入功課數字，導入「瀏覽器本地存儲」，並加上日期，並且顯示在div
    gkShow.innerHTML = ''
    btnSave2.onclick = () => {
        var gk1 = gkNum1.value
        var gk2 = gkNum2.value
        // 檢查是否有輸入資料
        if (!gk1 || !gk2) {
            alert('請輸入"功課名稱"與"數目"')
        } else {
            if (confirm('確定儲存？')) {
                localStorage['gk' + localNum('gk')] = addDate() + ' ' + gk2 + gk1 + '遍'
                // 頁面有查詢內容，就歸零
                if (s2 == 1) {
                    gkShow.innerHTML = ''
                    s2 = 0
                }
                gkShow.innerHTML += addDate() + ' <font>' + gk2 + gk1 + '遍</font>' + logo + '<br>'
                // 清空輸入的資料，才不會重複儲存
                gkNum1.value = null
            }
        }
        // 儲存功課名稱
        if (!localStorage['gkHead'] || localStorage['gkHead'] != gk2) {
            localStorage['gkHead'] = gk2
        }
    }
    // 儲存功課名稱，啟動程式時先顯示在文本框
    if (localStorage['gkHead']) {
        gkNum2.value = localStorage['gkHead']
    }
    // 查詢「瀏覽器本地存儲」中的內容，全部導入陣列，並返回
    btnSearch2.onclick = () => {
        // 查詢內容
        localDataAll('gk')
        // 顯示
        gkShow.innerHTML = DataAll.join('<br>')
        // alert(DataAll.join('\n'))
        // 清除使用過的陣列
        DataAll.length = 0
        // 記錄頁面已有資料
        s2 = 1
    }
    // 查詢「瀏覽器本地存儲」中的內容，統計總數，並返回數字
    btnSum2.onclick = () => {
        // 查詢內容+顯示
        gkShow.innerHTML = localDataSum('gk', '遍')
        // 記錄頁面已有資料
        s2 = 1
    }
    // 複製頁面顯示的任何資料
    btnCopy2.onclick = () => {
        txt1.value = gkShow.innerText
        Copy()
    }

    // 刪除所有記錄
    btnClean1.onclick = () => {
        // 詢問使用者：客戶要求問3次！
        if (confirm('你確定要執行刪除所有記錄？')) {
        if (confirm('不後悔嗎？真的決定刪除？')) {
        if (confirm('最後一次問你：確定要刪除所有記錄？')) {
            localStorage.clear()
            // 無法檢查是否完成，直接回報而已
            alert('刪除完畢')
        }
        }
        }
    }
    // 刪除各項記錄
    function DellocalDataAll(name, text3) {
        // 詢問使用者：客戶要求問3次！
        if (confirm('你確定要執行刪除資料？')) {
        if (confirm('不後悔嗎？真的決定刪除？')) {
        if (confirm('最後一次問你：確定要刪除所有' + text3 + '記錄？')) {
            for (var j = 1; j < 99999; j++) {
                if (localStorage[name + j]) {
                    delete localStorage[name + j]
                } else {
                    // 這裡可以加break，會快很多
                    // break
                    // 也可以直接回報
                    return alert('刪除完畢')
                }
            }
            // 檢查是否完成
            // if (localNum(name) == 1) {
            //     alert('刪除完畢')
            // }
        }
        }
        }
    }
    // 刪除所有念佛記錄
    btnClean2.onclick = () => {
        DellocalDataAll('nf', '念佛')
    }
    // 刪除所有功課記錄
    btnClean3.onclick = () => {
        DellocalDataAll('gk', '功課')
    }
}
</script>
</head>
<body>
    <div id="divmula" class="mula">
        <div id="div1" class="divShow">

            <table id="first">
                <tr>
                    <td class="tdup"><button id="addPWA" disabled>安裝成APP<br />iPhone請使用「加到主頁面」</button>
                    </td>
                    <td class="tdup"><button id="reload" onclick="javascript:window.location.reload()">重整頁面</button>
                    </td>
                </tr>
            </table>

            <iframe id="blog1" frameborder="0"></iframe>
        </div>
        
        <div id="div5" class="divShow">
            <iframe id="blog2" frameborder="0"></iframe>
        </div>

        <div id="div2" class="divShow">
            <div id="nfShow"></div>
            <input id="nfNum1" class="nfNumClass" type="number" placeholder="今日念佛總數" />
            <button id="btnSave1" class="nf">儲存</button>
            <br /><button id="btnSearch1" class="nf">查詢記錄</button> <button id="btnSum1" class="nf">總計</button> <button
                id="btnCopy1" class="nf">複製</button>
        </div>

        <div id="div3" class="divShow">
            <input id="gkNum2" class="gkNumClass" type="text" placeholder="功課名稱" />
            <div id="gkShow"></div>
            <br /><input id="gkNum1" class="gkNumClass" type="number" placeholder="今日功課總數" />
            <button id="btnSave2" class="nf gk">儲存</button>
            <br /><button id="btnSearch2" class="nf gk">查詢記錄</button> <button id="btnSum2" class="nf gk">總計</button>
            <button id="btnCopy2" class="nf gk">複製</button>
        </div>

        <div id="div4" class="divShow">

            <button id="btnClean0" class="nf">清除記錄</button>
            <table class="clean">
                <tr><td><button id="btnClean2" class="nf">清除佛號記錄</button></td></tr>
                <tr><td><button id="btnClean3" class="nf">清除功課記錄</button></td></tr>
                <tr><td><button id="btnClean1" class="nf">清除所有記錄</button></td></tr>
            </table>

            <div id="cleanShow">
                <table id="me">
                    <tr>
                        <td>帳號</td>
                        <td>
                            <ul>
                            <li>戶名：社團法人彰化縣三德精舍念佛會</li>
                            <li>劃撥：郵政劃撥帳號 22855554</li>
                            <li>銀行：(053)台中銀行 埤頭分行 079-22-0096762</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>組織資訊</td>
                        <td>
                            <ul>
                            <li>法人登記：109證社字第26號登記簿第10冊第185頁第825號</li>
                            <li>立案證書：府社發展字第109077號</li>
                            <li>統一編號：87165393</li>
                            <li>E-mail信箱：tw048911311@gmail.com</li>
                            <li>電話：04-8924737(常用)  04-8911311(社團專線)</li>
                            <li>共修地址：彰化縣埤頭鄉芙朝村庄後路144號(民宅)</li>
                            <li>新建精舍基地地址：彰化縣埤頭鄉新庄村新庄路418號(後面是基地)</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>社群媒體</td>
                        <td>
                            <ul>
                            <li><a href="https://www.facebook.com/groups/tw048911311" target="_blank">精舍FACEBOOK社團</a></li>
                            <li><a href="https://line.me/ti/g2/d9kondefPW9QyDG2_4H86S8WjC_S0vYHTvigsQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank">精舍LINE公告群</a></li>
                            <li><a href="https://www.youtube.com/@bsdv" target="_blank">精舍YOUTUBE</a></li>
                            <li><a href="https://www.youtube.com/@bsdv-1" target="_blank">精舍YOUTUBE-1</a></li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>比丘</td>
                        <td>
                            <ul>
                            <li>共同創建比丘：釋常誠、釋本傑、釋本知</li>
                            <li>道場主：釋常誠</li>
                            </ul>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <table>
        <tr>
            <!-- <div id="btnmula" class="mula"> -->
            <td class="tddown"><button id="btn1" class="btnshow">首頁</button></td>
            <td class="tddown"><button id="btn5" class="btnshow">最新<br />消息</button></td>
            <td class="tddown"><button id="btn2" class="btnshow">念佛<br />計數</button></td>
            <td class="tddown"><button id="btn3" class="btnshow">功課<br />計數</button></td>
            <td class="tddown"><button id="btn4" class="btnshow">關於我</button></td>
            <!-- </div> -->
        </tr>
    </table>

    <!-- 不能不顯示，否則無法運算 -->
    <!-- <textarea id="txt1" style="display: none;"></textarea> -->
    <textarea id="txt1" "></textarea>

    <script>
window.addEventListener('load', function () {
  var btnSave = document.getElementById('addPWA')
  var savedPrompt
  // 註冊serviceWorker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register(
      // Github路徑
      '/pwa_blog/sw.js',
      { scope: '/pwa_blog/' }
    )
      .then(function (registration) {
        console.log('ServiceWorker registration successful with scope:', registration.scope)
        // alert('安裝成功')
      }).catch(function (err) {
        console.log('ServiceWorker registration failed:', err)
        // alert('安裝失敗，請重新安裝')
      })
  }
  // 安裝按鈕
  window.addEventListener('beforeinstallprompt', function (e) {
    e.preventDefault()
    btnSave.removeAttribute('disabled')
    savedPrompt = e
    // 我設定true
    return true
    // return false
  })
  // 安裝按鈕
  btnSave.addEventListener('click', function () {
    if (savedPrompt !== undefined) {
      savedPrompt.prompt()

      savedPrompt.userChoice.then(function (result) {

        if (result.outcome == 'dismissed') {
          // alert('使用者關閉主營幕')
          console.log('User dismissed homescreen install')
        } else {
          // alert('使用者加入主營幕')
          console.log('User added to homescreen')
        }
        savedPrompt = null
      })
    }
  })
})


const cacheName = 'nfPWA';

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(cacheName)
      .then(cache => cache.addAll([
    //   只要有一個載入失敗，就全部失敗，所以盡量少
        '/pwa_blog/index.html',
        // 'css1.css',
        // 'nf.js',
        // 'sw.js',
        // 'blog.webmanifest',
        // 'icons/sd48.png',
        // 'icons/sd192.png',
        '/pwa_blog/icons/sd512.png'
        // 不知道Github路徑，只好全部加入
        // '/pwa_blog/index.html',
        // '/pwa_blog/css1.css',
        // '/pwa_blog/nf.js',
        // '/pwa_blog/sw.js',
        // '/pwa_blog/blog.webmanifest',
        // '/pwa_blog/icons/sd48.png',
        // '/pwa_blog/icons/sd192.png',
        // '/pwa_blog/icons/sd512.png'
      ]))
  )
})

self.addEventListener('fetch', function (event) {
  event.respondWith(
    caches.match(event.request, { ignoreSearch: true })
      .then(function (response) {
        if (response) {
          return response
        }

        var requestToCache = event.request.clone()

        return fetch(requestToCache).then(
          function (response) {
            if (!response || response.status !== 200) {
              return response
            }

            var requestToCache = response.clone()

            cache.open(cacheName)
              .then(function (cache) {
                cache.put(requestToCache, requestToCache)
              })
            return response
          }
        )
      })
  )
});
    </script>
</body>

</html>